(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-716ee1f2"],{"2ed1":function(t,e,i){"use strict";var n=i("b6f3"),s=i.n(n);s.a},"6ab8":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"input-single-file"},[t.value?i("div",{staticClass:"preview"},t._l(t.files,function(e,n){return i("v-card",{key:e.id,staticClass:"card",attrs:{title:e.title,subtitle:e.subtitle,src:e.src,icon:e.icon,href:e.href,options:{remove:{text:t.$t("delete"),icon:"delete"},edit:{text:t.$t("interfaces-files-edit_item"),icon:"edit"}}},on:{remove:function(i){return t.deleteFile(e[t.relatedPrimaryKeyField.field])},edit:function(e){return t.editFile(n)}}})}),1):t._e(),i("v-button",{attrs:{type:"button",disabled:t.readonly},on:{click:function(e){t.newFile=!0}}},[i("v-icon",{attrs:{name:"add"}}),t._v("\n    "+t._s(t.$t("new_file"))+"\n  ")],1),i("v-button",{attrs:{type:"button",disabled:t.readonly},on:{click:function(e){t.existing=!0}}},[i("v-icon",{attrs:{name:"playlist_add"}}),t._v("\n    "+t._s(t.$t("existing"))+"\n  ")],1),t.newFile?i("portal",{attrs:{to:"modal"}},[i("v-modal",{attrs:{buttons:{done:{text:t.$t("done")}},title:t.$t("file_upload")},on:{close:function(e){t.newFile=!1},done:function(e){t.newFile=!1}}},[i("div",{staticClass:"body"},[i("v-upload",{attrs:{multiple:!0,accept:t.options.accept},on:{upload:t.saveUpload}})],1)])],1):t._e(),t.existing?i("portal",{attrs:{to:"modal"}},[i("v-modal",{attrs:{title:t.$t("choose_one"),buttons:{done:{text:t.$t("done")}},"action-required":""},on:{close:function(e){t.existing=!1},done:function(e){t.existing=!1}}},[i("div",{staticClass:"search"},[i("v-input",{staticClass:"search-input",attrs:{type:"search",placeholder:t.$t("search")},on:{input:t.onSearchInput}})],1),i("v-items",{staticClass:"items",attrs:{collection:t.relation.junction.collection_one.collection,"view-type":t.viewType,selection:t.selection,filters:t.filters,"view-query":t.viewQuery,"view-options":t.viewOptions},on:{options:t.setViewOptions,query:t.setViewQuery,select:t.selectItems}})],1)],1):t._e(),t.editExisting?i("portal",{staticClass:"edit-modal",attrs:{to:"modal"}},[i("v-modal",{attrs:{title:t.$t("editing_item"),buttons:{save:{text:"Save",color:"accent",loading:t.selectionSaving}}},on:{close:function(e){t.editExisting=!1},save:t.saveEdits}},[i("div",{staticClass:"edit-modal-body"},[i("v-form",{attrs:{fields:t.relatedCollectionFields,values:t.editExisting[t.junctionFieldName]},on:{"stage-value":t.stageValue}})],1)])],1):t._e()],1)},s=[],a=(i("6762"),i("2fdb"),i("bd86")),r=i("75fc"),o=i("cebc"),l=(i("f559"),i("28a5"),i("7514"),i("8db2")),u=i.n(l);function c(t){return"application/pdf"===t?"picture_as_pdf":t.startsWith("application")?"insert_drive_file":t.startsWith("image")?"crop_original":t.startsWith("video")?"videocam":t.startsWith("code")?"code":t.startsWith("audio")?"audiotrack":"save"}var d={mixins:[u.a],data:function(){return{newFile:!1,existing:!1,editExisting:!1,selectionSaving:!1,viewOptionsOverride:{},viewTypeOverride:null,viewQueryOverride:{},filtersOverride:[],editThisFile:{},edits:{}}},computed:{junctionFieldName:function(){return this.relation.junction.field_many.field},relatedCollectionFields:function(){return this.relation.junction.collection_one.fields},junctionPrimaryKey:function(){return this.$lodash.find(this.relation.collection_many.fields,{primary_key:!0}).field},files:function(){var t=this;return this.value?this.value.filter(function(t){return!t.$delete}).map(function(e){var i=e[t.junctionFieldName];return{id:i[t.relatedPrimaryKeyField.field],title:i.title,subtitle:i.filename.split(".").pop()+" • "+t.$d(new Date(i.uploaded_on),"short"),src:i.type&&i.type.startsWith("image")?i.data.thumbnails[0].url:null,icon:i.type&&!i.type.startsWith("image")?c(i.type):null,href:i.type&&"application/pdf"===i.type?i.data.full_url:null}}):[]},relatedPrimaryKeyField:function(){return this.$lodash.find(this.relation.junction.collection_one.fields,{primary_key:!0})},selection:function(){var t=this;return this.value?this.value.filter(function(t){return!t.$delete}).map(function(e){return e[t.junctionFieldName]}):[]},viewOptions:function(){var t=this.options.viewOptions;return Object(o["a"])({},t,this.viewOptionsOverride)},viewType:function(){return this.viewTypeOverride?this.viewTypeOverride:this.options.viewType},viewQuery:function(){var t=this.options.viewQuery;return Object(o["a"])({},t,this.viewQueryOverride)},filters:function(){return[].concat(Object(r["a"])(this.options.filters),Object(r["a"])(this.fileTypeFilters),Object(r["a"])(this.filtersOverride))},fileTypeFilters:function(){return!this.options.accept||this.filtersOverride.length>0||this.options.filters.some(function(t){return"type"===t.field})?[]:[{field:"type",operator:"in",value:this.options.accept.trim().split(/,\s*/)}]}},methods:{saveUpload:function(t){this.$emit("input",[].concat(Object(r["a"])(this.value),[Object(a["a"])({},this.junctionFieldName,t.data)]))},selectItems:function(t){var e=this,i=this.value||[],n=i.map(function(t){return t[e.junctionFieldName]}),s=this.relatedPrimaryKeyField.field,l=n.map(function(t){return t[s]}),u=t.map(function(t){return t[s]}),c=l.filter(function(t){return!1===u.includes(t)}),d=i.filter(function(t){return c.includes(t[e.junctionFieldName][s])}).map(function(t){return Object(o["a"])({},t,{$delete:!0})}),p=t.map(function(t){return Object(a["a"])({},e.junctionFieldName,t)});this.$emit("input",[].concat(Object(r["a"])(d),Object(r["a"])(p)))},deleteFile:function(t){var e=this,i=this.value.map(function(i){var n=i[e.junctionFieldName];return n[e.relatedPrimaryKeyField.field]===t?Object(o["a"])({},i,{$delete:!0}):i});this.$emit("input",i)},editFile:function(t){this.editExisting=this.value[t]},stageValue:function(t){var e=t.field,i=t.value;this.$set(this.edits,e,i)},saveEdits:function(){var t=this;this.$emit("input",Object(r["a"])((this.value||[]||[]).map(function(e){return e.id===t.editExisting[t.junctionPrimaryKey]?Object(o["a"])({},e,Object(a["a"])({},t.junctionFieldName,Object(o["a"])({},e[t.junctionFieldName],t.edits))):e}))),this.edits={},this.editExisting=!1},setViewOptions:function(t){this.viewOptionsOverride=Object(o["a"])({},this.viewOptionsOverride,t)},setViewQuery:function(t){this.viewQueryOverride=Object(o["a"])({},this.viewQueryOverride,t)},onSearchInput:function(t){this.setViewQuery({q:t})}},created:function(){this.onSearchInput=this.$lodash.debounce(this.onSearchInput,200)}},p=d,f=(i("2ed1"),i("2877")),v=Object(f["a"])(p,n,s,!1,null,"2882556f",null);e["default"]=v.exports},"8db2":function(t,e){t.exports={props:{id:{type:String,required:!0},name:{type:String,required:!0},value:{type:null,default:null},type:{type:String,required:!0},length:{type:[String,Number],default:null},readonly:{type:Boolean,default:!1},required:{type:Boolean,default:!1},options:{type:Object,default:()=>({})},newItem:{type:Boolean,default:!1},relation:{type:Object,default:null},fields:{type:Object,default:null},values:{type:Object,default:null}}}},b6f3:function(t,e,i){}}]);
//# sourceMappingURL=chunk-716ee1f2.be82f972.js.map